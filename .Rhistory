),
indu_code = substr(seriesID, 4, 11),
data_type_code = substr(seriesID, 12, 13)
) %>%
dplyr::left_join(
y = ces_national_codes_list$indu_codes %>%
dplyr::distinct(
industry_code,
.keep_all = TRUE
) %>%
dplyr::rename(
industry_name = description
) %>%
dplyr::select(
industry_code,
industry_name,
private_sector_flag,
bls_sector_code
),
by = c("indu_code" = "industry_code")
) %>%
dplyr::left_join(
y = ces_national_codes_list$data_types %>%
dplyr::rename(
variable_name = description
),
by = c("data_type_code" = "data_type_code")
) %>%
dplyr::left_join(
y = naics_industry_mappings$ces_to_naics_map %>%
dplyr::select(
industry_code,
#naics_sector_code,
#naics_sector_name,
naics_supersector_code,
naics_supersector_name
),
by = c("indu_code" = "industry_code")
)
table(a$naics_supersector_name)
sum(is.na(a$naics_supersector_name))
a = bls_df %>%
dplyr::mutate(
archive = lubridate::year(date)*100 + lubridate::month(date),
seasonal_code = substr(seriesID, 3, 3),
seasonal_code = ifelse(
seasonal_code == "S",
"seasonally adjusted",
"unadjusted"
),
indu_code = substr(seriesID, 4, 11),
data_type_code = substr(seriesID, 12, 13)
) %>%
dplyr::left_join(
y = ces_national_codes_list$indu_codes %>%
dplyr::distinct(
industry_code,
.keep_all = TRUE
) %>%
dplyr::rename(
industry_name = description
) %>%
dplyr::select(
industry_code,
industry_name,
private_sector_flag,
bls_sector_code
),
by = c("indu_code" = "industry_code")
) %>%
dplyr::left_join(
y = ces_national_codes_list$data_types %>%
dplyr::rename(
variable_name = description
),
by = c("data_type_code" = "data_type_code")
) %>%
dplyr::left_join(
y = naics_industry_mappings$ces_to_naics_map %>%
dplyr::select(
industry_code,
naics_sector_code,
naics_sector_name,
naics_supersector_code,
naics_supersector_name
),
by = c("indu_code" = "industry_code")
)
head(a) %>% data.frame()
table(a$naics_sector_name)
table(a$naics_sector_code)
naics_industry_mappings = list(naics_supersector_map =
readr::read_csv(file="./data-raw/naics_supersector_map.csv"),
jolts_to_naics_map =
readr::read_csv(file="./data-raw/jolts_indu_to_naics_map.csv") %>%
filter(!is.na(naics_supersector_code)),
ces_to_naics_map =
readr::read_csv(file="./data-raw/ces_indu_to_naics_map.csv") %>%
filter(!is.na(naics_supersector_code)))
a = bls_df %>%
dplyr::mutate(
archive = lubridate::year(date)*100 + lubridate::month(date),
seasonal_code = substr(seriesID, 3, 3),
seasonal_code = ifelse(
seasonal_code == "S",
"seasonally adjusted",
"unadjusted"
),
indu_code = substr(seriesID, 4, 11),
data_type_code = substr(seriesID, 12, 13)
) %>%
dplyr::left_join(
y = ces_national_codes_list$indu_codes %>%
dplyr::distinct(
industry_code,
.keep_all = TRUE
) %>%
dplyr::rename(
industry_name = description
) %>%
dplyr::select(
industry_code,
industry_name,
private_sector_flag,
bls_sector_code
),
by = c("indu_code" = "industry_code")
) %>%
dplyr::left_join(
y = ces_national_codes_list$data_types %>%
dplyr::rename(
variable_name = description
),
by = c("data_type_code" = "data_type_code")
) %>%
dplyr::left_join(
y = naics_industry_mappings$ces_to_naics_map %>%
dplyr::select(
industry_code,
naics_sector_code,
naics_sector_name,
naics_supersector_code,
naics_supersector_name
),
by = c("indu_code" = "industry_code")
)
table(a$naics_sector_code)
?read_csv
readr::read_csv(file="./data-raw/ces_indu_to_naics_map.csv")
readr::read_csv(file="./data-raw/ces_indu_to_naics_map.csv",guess_max=100)
readr::read_csv(file="./data-raw/ces_indu_to_naics_map.csv",guess_max=100) %>% data.frame()
readr::read_csv(file="./data-raw/ces_indu_to_naics_map.csv",guess_max=100)
readr::read_csv(file="./data-raw/ces_indu_to_naics_map.csv",guess_max=100) %>% data.frame()
readr::read_csv(file="./data-raw/ces_indu_to_naics_map.csv",guess_max=100)
readr::read_csv(file="./data-raw/ces_indu_to_naics_map.csv",guess_max=100) %>% data.frame()
readr::read_csv(file="./data-raw/ces_indu_to_naics_map.csv",guess_max=100)
readr::read_csv(file="./data-raw/ces_indu_to_naics_map.csv",guess_max=100) %>% data.frame()
readr::read_csv(file="./data-raw/ces_indu_to_naics_map.csv",guess_max=100) %>% data.frame()
bls_df %>%
dplyr::mutate(
archive = lubridate::year(date)*100 + lubridate::month(date),
seasonal_code = substr(seriesID, 3, 3),
seasonal_code = ifelse(
seasonal_code == "S",
"seasonally adjusted",
"unadjusted"
),
indu_code = substr(seriesID, 4, 11),
data_type_code = substr(seriesID, 12, 13)
) %>%
dplyr::left_join(
y = ces_national_codes_list$indu_codes %>%
dplyr::distinct(
industry_code,
.keep_all = TRUE
) %>%
dplyr::rename(
industry_name = description
) %>%
dplyr::select(
industry_code,
industry_name,
private_sector_flag,
bls_sector_code
),
by = c("indu_code" = "industry_code")
) %>%
dplyr::left_join(
y = ces_national_codes_list$data_types %>%
dplyr::rename(
variable_name = description
),
by = c("data_type_code" = "data_type_code")
) %>%
dplyr::left_join(
y = naics_industry_mappings$ces_to_naics_map %>%
dplyr::select(
industry_code,
naics_sector_code,
naics_sector_name,
naics_supersector_code,
naics_supersector_name
),
by = c("indu_code" = "industry_code")
)
bls_df %>%
dplyr::mutate(
archive = lubridate::year(date)*100 + lubridate::month(date),
seasonal_code = substr(seriesID, 3, 3),
seasonal_code = ifelse(
seasonal_code == "S",
"seasonally adjusted",
"unadjusted"
),
indu_code = substr(seriesID, 4, 11),
data_type_code = substr(seriesID, 12, 13)
) %>%
dplyr::left_join(
y = ces_national_codes_list$indu_codes %>%
dplyr::distinct(
industry_code,
.keep_all = TRUE
) %>%
dplyr::rename(
industry_name = description
) %>%
dplyr::select(
industry_code,
industry_name,
private_sector_flag,
bls_sector_code
),
by = c("indu_code" = "industry_code")
) %>%
dplyr::left_join(
y = ces_national_codes_list$data_types %>%
dplyr::rename(
variable_name = description
),
by = c("data_type_code" = "data_type_code")
) %>%
dplyr::left_join(
y = naics_industry_mappings$ces_to_naics_map %>%
dplyr::select(
industry_code,
naics_sector_code,
naics_sector_name,
naics_supersector_code,
naics_supersector_name
),
by = c("indu_code" = "industry_code")
) %>% head() %>% data.frame()
a = guess_max
a = bls_df %>%
dplyr::mutate(
archive = lubridate::year(date)*100 + lubridate::month(date),
seasonal_code = substr(seriesID, 3, 3),
seasonal_code = ifelse(
seasonal_code == "S",
"seasonally adjusted",
"unadjusted"
),
indu_code = substr(seriesID, 4, 11),
data_type_code = substr(seriesID, 12, 13)
) %>%
dplyr::left_join(
y = ces_national_codes_list$indu_codes %>%
dplyr::distinct(
industry_code,
.keep_all = TRUE
) %>%
dplyr::rename(
industry_name = description
) %>%
dplyr::select(
industry_code,
industry_name,
private_sector_flag,
bls_sector_code
),
by = c("indu_code" = "industry_code")
) %>%
dplyr::left_join(
y = ces_national_codes_list$data_types %>%
dplyr::rename(
variable_name = description
),
by = c("data_type_code" = "data_type_code")
) %>%
dplyr::left_join(
y = naics_industry_mappings$ces_to_naics_map %>%
dplyr::select(
industry_code,
naics_sector_code,
naics_sector_name,
naics_supersector_code,
naics_supersector_name
),
by = c("indu_code" = "industry_code")
)
a
table(a$naics_sector_code)
naics_industry_mappings$ces_to_naics_map %>%
dplyr::select(
industry_code,
naics_sector_code,
naics_sector_name,
naics_supersector_code,
naics_supersector_name
)
naics_industry_mappings = list(naics_supersector_map =
readr::read_csv(file="./data-raw/naics_supersector_map.csv"),
jolts_to_naics_map =
readr::read_csv(file="./data-raw/jolts_indu_to_naics_map.csv") %>%
filter(!is.na(naics_supersector_code)),
ces_to_naics_map =
readr::read_csv(file="./data-raw/ces_indu_to_naics_map.csv") %>%
filter(!is.na(naics_supersector_code)))
a = bls_df %>%
dplyr::mutate(
archive = lubridate::year(date)*100 + lubridate::month(date),
seasonal_code = substr(seriesID, 3, 3),
seasonal_code = ifelse(
seasonal_code == "S",
"seasonally adjusted",
"unadjusted"
),
indu_code = substr(seriesID, 4, 11),
data_type_code = substr(seriesID, 12, 13)
) %>%
dplyr::left_join(
y = ces_national_codes_list$indu_codes %>%
dplyr::distinct(
industry_code,
.keep_all = TRUE
) %>%
dplyr::rename(
industry_name = description
) %>%
dplyr::select(
industry_code,
industry_name,
private_sector_flag,
bls_sector_code
),
by = c("indu_code" = "industry_code")
) %>%
dplyr::left_join(
y = ces_national_codes_list$data_types %>%
dplyr::rename(
variable_name = description
),
by = c("data_type_code" = "data_type_code")
) %>%
dplyr::left_join(
y = naics_industry_mappings$ces_to_naics_map %>%
dplyr::select(
industry_code,
naics_sector_code,
naics_sector_name,
naics_supersector_code,
naics_supersector_name
),
by = c("indu_code" = "industry_code")
)
a
table(a$naics_sector_code)
sum(is.na(a$naics_sector_code)
)
sum(is.na(a$naics_sector_name))
bls_df = bls_df %>%
dplyr::mutate(
archive = lubridate::year(date)*100 + lubridate::month(date),
seasonal_code = substr(seriesID, 3, 3),
seasonal_code = ifelse(
seasonal_code == "S",
"seasonally adjusted",
"unadjusted"
),
indu_code = substr(seriesID, 4, 11),
data_type_code = substr(seriesID, 12, 13)
) %>%
dplyr::left_join(
y = ces_national_codes_list$indu_codes %>%
dplyr::distinct(
industry_code,
.keep_all = TRUE
) %>%
dplyr::rename(
industry_name = description
) %>%
dplyr::select(
industry_code,
industry_name,
private_sector_flag,
bls_sector_code
),
by = c("indu_code" = "industry_code")
) %>%
dplyr::left_join(
y = ces_national_codes_list$data_types %>%
dplyr::rename(
variable_name = description
),
by = c("data_type_code" = "data_type_code")
) %>%
dplyr::left_join(
y = naics_industry_mappings$ces_to_naics_map %>%
dplyr::select(
industry_code,
naics_sector_code,
naics_sector_name,
naics_supersector_code,
naics_supersector_name
),
by = c("indu_code" = "industry_code")
) %>%
dplyr::mutate(
month = as.numeric(gsub("M", "", period))
) %>%
dplyr::select(
archive,
month,
period,
seriesID,
variable_name,
value,
seasonal_code,
industry_name,
industry_level,
private_sector_flag,
bls_sector_code,
naics_sector_code,
naics_sector_name,
naics_supersector_code,
naics_supersector_name
)
bls_df
bls_df = bls_df %>%
dplyr::mutate(
archive = lubridate::year(date)*100 + lubridate::month(date),
seasonal_code = substr(seriesID, 3, 3),
seasonal_code = ifelse(
seasonal_code == "S",
"seasonally adjusted",
"unadjusted"
),
indu_code = substr(seriesID, 4, 11),
data_type_code = substr(seriesID, 12, 13)
) %>%
dplyr::left_join(
y = ces_national_codes_list$indu_codes %>%
dplyr::distinct(
industry_code,
.keep_all = TRUE
) %>%
dplyr::rename(
industry_name = description
) %>%
dplyr::select(
industry_code,
industry_name,
private_sector_flag,
bls_sector_code
),
by = c("indu_code" = "industry_code")
) %>%
dplyr::left_join(
y = ces_national_codes_list$data_types %>%
dplyr::rename(
variable_name = description
),
by = c("data_type_code" = "data_type_code")
) %>%
dplyr::left_join(
y = naics_industry_mappings$ces_to_naics_map %>%
dplyr::select(
industry_code,
naics_sector_code,
naics_sector_name,
naics_supersector_code,
naics_supersector_name
),
by = c("indu_code" = "industry_code")
) %>%
dplyr::mutate(
month = as.numeric(gsub("M", "", period))
) %>%
dplyr::select(
archive,
month,
period,
seriesID,
variable_name,
value,
seasonal_code,
industry_name,
private_sector_flag,
bls_sector_code,
naics_sector_code,
naics_sector_name,
naics_supersector_code,
naics_supersector_name
)
bls_df
bls_df %>% head() %>% data.fraem()
bls_df %>% head() %>% data.frame()
table(bls_df$naics_supersector_name)
table(bls_df$naics_supersector_name, bls_df$naics_sector_name)
devtools::load_all()
devtools::document()
devtools::load_all()
